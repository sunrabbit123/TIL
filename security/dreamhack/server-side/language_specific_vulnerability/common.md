# Common

웹 어플리케이션 언어에서 공통적으로 조심해야 하는 함수 및 패턴에 대해 다룰 예정입니다.

## 목차

1. [eval](common.md#eval)
2. [Os Command Function](common.md#OS-Command-Function)
3. [Filesystem function](common.md#Filesystem-function)
4. [serialize/deserialize](common.md#serialize-deserialize)

   **eval**

인자로 입력된 문자열을 어플리케이션 코드로 실행하는 함수이다.

* php

  ```php
  <?php
    eval("1+1");//2
  ?>
  ```

* python

  ```python
  eval("1+1") # 2
  eval("2+2") # 4
  # eval은 하나의 식만을 처리하지만, exec는 하나의 문장을 처리한다.
  eval("a=1") # SyntaxError : invaild syntax
  exec("a=1") # a = 1
  eval("import os; os.system('cls')")
  ```

* javascript

  ```javascript
  eval("1+1"); // 2
  ```

eval의 인자로 사용자 입력값이 사용되면 악의적인 데이터를 입력해 원하는 코드를 실행가능하기에 사용자의 입력데이터가 eval의 인자로 사용되지 않아야 한다.

## OS Command Function

OS Command를 실행하기 위해 함수를 사용 시 실행하는 명령어에 사용자의 입력 데이터가 포함될 경우 Command Injection 취약점이 발생할 수 있다.

* Python
  * os.system, popen
  * subprocess.call, run, Popen
* PHP
  * system, passthru
  * shell\_exec, backtick operator\(e.g.`ls`\)
  * popen, proc\_open
  * exec
* Javascript\(Nodejs\)
  * child\_process.exec, spawn

## Filesystem function

앱에서 파일 시스템에 접근할 수 있는 함수들의 인자가 사용자의 입력 데이터 도는 변조될 가능성이 있는 변수들을 사용할 경우 서버의 파일 시스템을 공격하거나, 다른 취약점으로 악용될 수 있습니다.

파일 시스템을 공격하여 발생할 수 있는 대표적이 서버의 피해는 이와 같습니다.

> 서버 또는 어플리케이션의 환경, 상황에 따라 발생할 수 있는 문제는 각 각 다를 수 있습니다.

* File Read
  * 정보 노출
    * python

      ```python
      open(filename).read()
      ```

    * javascript \(NodeJs\)

      ```javascript
        var fs = require('fs');
        fs.readFileSync(filename);
      ```

    * php

      ```php
        <?php
            file_get_contents($filename);
            fopen($filename, "r");
            readfile($filename);
            show_source($filename);
            highlight_file($filename);
            # etc
            include $filename;
        ?>
      ```

      include는 read하는 파일에 php태그가 포함 될 경우 해당 php태그를 해석하고 실행하는 기능도 포함되어 있습니다.
* File Write
  * WebShell을 통한 원격 코드 실행 공격
  * 기존 설정 파일을 덮는 공격을 통해 설정 변경
    * python

      ```python
      open(filename, "w").write(data)
      ```

    * javascript

      ```javascript
      var fs = require('fs');
      fs.writeFileSync(filename, data);
      ```

    * php

      ```php
      <?php
        file_put_contents($filename, $data);
        fopen($filename, "w");
        ...
      ?>
      ```
* Etc
  * 파일 복사를 통해 File Write와 유사한 상황 발생
    * 파일 복사

      ```text
      # python
      import shutil
      shutil.copy('Original_FILE', 'Copy_FILE')

      # javascript
      const fs = require('fs');
      fs.copyFIleSync('Original_FILE', 'Copy_FILE');

      # php
      <?php
        copy('Original_FILE', 'Copy_FILE');
      ?>
      ```
  * 설정 파일을 삭제하여 운영체제 또는 어플리케이션 서비스 무력화
    * 파일 삭제

      ```text
      # python
      import os
      os.remove(filename)

      # javascript (Nodejs)
      const fs = require('fs');
      fs.unlinkSync(filename);

      # php
      <?php 
        unlink($filename);
      ?>
      ```

## seiralize deserialize

serialize\(직렬화\)는 object 또는 Data의 상태 또는 타입을 특정한 형태의 포맷을 가진 데이터로 변환하는 것을 의미한다.

deserialize\(역직렬화\)는 직렬화된 데이터를 원래의 object 또는 Data의 상태 또는 타입으로 변환하는 것을 의미합니다.

